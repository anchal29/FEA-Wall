% Function to create mesh for the provided wall considering the
% reinforcement detailings are also provided.
% Returns the nodal connectivity and nodal coordinate matrices.

% Input parameters:
% dimension = [thickness, width, height];
% divisions = [div_x, div_y, div_z];
% reinforcment_info = [vertical_dia, vertical_spacing, vert_side_cover;
%                      horz_dia    , horz_spacing    , horz_side_cover];

function [nodal_connect, nodal_coordinate] = createMesh(dimension, divisions, reinforcment_info)
% Total number of bars in y and z direction
num_bars = floor((dimension(2:3) - 2*reinforcment_info(:,3).')./reinforcment_info(:,2).');

% num_vert_bars = floor((dimension(2) - 2*reinforcment_info(1,3))/reinforcment_info(1,2));
% num_horz_bars = floor((dimension(3) - 2*reinforcment_info(2,3))/reinforcment_info(2,2));

% Verticle bars will be distributed in y direction while the horizontal
% bars are in z direction repectively.
% Bar position of say nth bar is simply the side cover + n-1 times the
% spacing.

% bars_position = (0:num_bars)*reinforcment_info(:,2) + reinforcment_info(:,3);
vert_bars_poistion = (0:num_bars(1))*reinforcment_info(1,2) + reinforcment_info(1,3); % Along y-axis
horz_bars_poistion = (0:num_bars(2))*reinforcment_info(2,2) + reinforcment_info(2,3); % Along z-axis

% Gives x_dim, y_dim and z_dim i.e. the mesh size in all the directions.
mesh_size = 50 * floor((dimension./divisions)/50);

%% Create nodal connectivity and coordinate matrices

% Now we need to find out all the coordinate values for each elements.
% y_coord = helper(mesh_size(2), vert_bars_poistion, reinforcment_info(1,1), dimension(2));
% z_coord = helper(mesh_size(3), horz_bars_poistion, reinforcment_info(2,1), dimension(3));
% disp(y_coord);
% disp(z_coord);
% disp(mesh_size);
% disp(node_y == y_coord);
x_coord = get_x(dimension(1), reinforcment_info, mesh_size(1));
disp(x_coord);
end

function [coordinates] = helper(mesh_size, bars_pos, bar_dia, dimension)
    coordinates = 0;
    index = 1;
    fine_meshing = 2;
    flag = 0;
    while(flag == 0)
        coord_val = min(coordinates(end) + mesh_size, dimension);
        if(index > length(bars_pos))
            coordinates(end + 1) = coord_val;
        elseif(coord_val >= bars_pos(index) - fine_meshing*bar_dia)
            temp = -fine_meshing:fine_meshing;
            % Considering fine_meshing number of elements around the bars.
            % So as to get finer mesh around it.
            coordinates = [coordinates, bars_pos(index) + bar_dia*temp];
            index = index + 1;
        else
            coordinates(end + 1) = coord_val;
        end
        flag = coord_val >= dimension;
    end
end

function[x_coordinates] = get_x(dimension, reinforcment_info, mesh_size)

clear_cover = 40;
x_coordinates = 0;
flag = 1;
fine_meshing = 3;
% First and last case denotes that he horizontal steel comes before 
% verticle while moving along the thickness of wall and the middle one 
% shows the otherwise.
if(dimension(1) <= 170)
    bar_dia = [reinforcment_info(2,1), reinforcment_info(2,1)];
    bars_pos = [floor(dimension/2) - reinforcment_info(2,1), floor(dimension/2)];
elseif(dimension(1) > 220)
    bar_dia = [reinforcment_info(1,1), reinforcment_info(2,1), reinforcment_info(2,1), reinforcment_info(1,1)];
    bars_pos = [clear_cover, clear_cover + reinforcment_info(1,1), dimension - clear_cover - sum(reinforcment_info(:,1)), dimension - clear_cover - reinforcment_info(1,1)];
else
    bar_dia = [reinforcment_info(2,1), reinforcment_info(1,1), reinforcment_info(1,1), reinforcment_info(2,1)];
    bars_pos = [clear_cover, clear_cover + reinforcment_info(2,1), dimension - clear_cover - sum(reinforcment_info(:,1)), dimension - clear_cover - reinforcment_info(2,1)];
end
x_coordinates  = helper2(mesh_size, bars_pos, bar_dia, dimension);
end


function [coordinates] = helper2(mesh_size, bars_pos, bar_dia, dimension)
    coordinates = 0;
    index = 1;
    fine_meshing = 2;
    flag = 0;
    
    temp_mat = [-fine_meshing:0;0:fine_meshing]
    while(flag == 0)
        coord_val = min(coordinates(end) + mesh_size, dimension);
        if(index > length(bars_pos))
            coordinates(end + 1) = coord_val;
        elseif(coord_val >= bars_pos(index) - fine_meshing*bar_dia(index))
            temp = temp_mat(index);
            % Considering fine_meshing number of elements around the bars.
            % So as to get finer mesh around it.
            coordinates = [coordinates, bars_pos(index) + bar_dia(index)*temp];
            index = index + 1;
        else
            coordinates(end + 1) = coord_val;
        end
        flag = coord_val >= dimension;
    end
end
